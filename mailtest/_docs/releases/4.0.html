
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Django 4.0 release notes - UNDER DEVELOPMENT &#8212; Django 4.0.dev20210615100128 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/default.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Django 3.2.5 release notes" href="3.2.5.html" />
    <link rel="prev" title="Release notes" href="index.html" />



 
<script src="../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../index.html">Django 4.0.dev20210615100128 documentation</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../index.html">Home</a>  |
        <a title="Table of contents" href="../contents.html">Table of contents</a>  |
        <a title="Global index" href="../genindex.html">Index</a>  |
        <a title="Module index" href="../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="index.html" title="Release notes">previous</a>
     |
    <a href="index.html" title="Release notes" accesskey="U">up</a>
   |
    <a href="3.2.5.html" title="Django 3.2.5 release notes">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="releases-4.0">
            
  <div class="section" id="s-django-4-0-release-notes-under-development">
<span id="django-4-0-release-notes-under-development"></span><h1>Django 4.0 release notes - UNDER DEVELOPMENT<a class="headerlink" href="#django-4-0-release-notes-under-development" title="Permalink to this headline">¶</a></h1>
<p><em>Expected December 2021</em></p>
<p>Welcome to Django 4.0!</p>
<p>These release notes cover the <a class="reference internal" href="#whats-new-4-0"><span class="std std-ref">new features</span></a>, as well as
some <a class="reference internal" href="#backwards-incompatible-4-0"><span class="std std-ref">backwards incompatible changes</span></a> you’ll
want to be aware of when upgrading from Django 3.2 or earlier. We’ve
<a class="reference internal" href="#deprecated-features-4-0"><span class="std std-ref">begun the deprecation process for some features</span></a>.</p>
<p>See the <a class="reference internal" href="../howto/upgrade-version.html"><span class="doc">Upgrading Django to a newer version</span></a> guide if you’re updating an existing
project.</p>
<div class="section" id="s-python-compatibility">
<span id="python-compatibility"></span><h2>Python compatibility<a class="headerlink" href="#python-compatibility" title="Permalink to this headline">¶</a></h2>
<p>Django 4.0 supports Python 3.8, 3.9, and 3.10. We <strong>highly recommend</strong> and only
officially support the latest release of each series.</p>
<p>The Django 3.2.x series is the last to support Python 3.6 and 3.7.</p>
</div>
<div class="section" id="s-what-s-new-in-django-4-0">
<span id="s-whats-new-4-0"></span><span id="what-s-new-in-django-4-0"></span><span id="whats-new-4-0"></span><h2>What’s new in Django 4.0<a class="headerlink" href="#what-s-new-in-django-4-0" title="Permalink to this headline">¶</a></h2>
<div class="section" id="s-functional-unique-constraints">
<span id="functional-unique-constraints"></span><h3>Functional unique constraints<a class="headerlink" href="#functional-unique-constraints" title="Permalink to this headline">¶</a></h3>
<p>The new <a class="reference internal" href="../ref/models/constraints.html#django.db.models.UniqueConstraint.expressions" title="django.db.models.UniqueConstraint.expressions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">*expressions</span></code></a>
positional argument of
<a class="reference internal" href="../ref/models/constraints.html#django.db.models.UniqueConstraint" title="django.db.models.UniqueConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueConstraint()</span></code></a> enables
creating functional unique constraints on expressions and database functions.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">UniqueConstraint</span>
<span class="kn">from</span> <span class="nn">django.db.models.functions</span> <span class="kn">import</span> <span class="n">Lower</span>


<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">UniqueConstraint</span><span class="p">(</span>
                <span class="n">Lower</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">),</span>
                <span class="n">Lower</span><span class="p">(</span><span class="s1">&#39;last_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">desc</span><span class="p">(),</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;first_last_name_unique&#39;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">]</span>
</pre></div>
</div>
<p>Functional unique constraints are added to models using the
<a class="reference internal" href="../ref/models/options.html#django.db.models.Options.constraints" title="django.db.models.Options.constraints"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Meta.constraints</span></code></a> option.</p>
</div>
<div class="section" id="s-minor-features">
<span id="minor-features"></span><h3>Minor features<a class="headerlink" href="#minor-features" title="Permalink to this headline">¶</a></h3>
<div class="section" id="s-django-contrib-admin">
<span id="django-contrib-admin"></span><h4><a class="reference internal" href="../ref/contrib/admin/index.html#module-django.contrib.admin" title="django.contrib.admin: Django's admin site."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a><a class="headerlink" href="#django-contrib-admin" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">admin/base.html</span></code> template now has a new block <code class="docutils literal notranslate"><span class="pre">header</span></code> which
contains the admin site header.</li>
<li>The new <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.get_formset_kwargs" title="django.contrib.admin.ModelAdmin.get_formset_kwargs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ModelAdmin.get_formset_kwargs()</span></code></a> method allows customizing the
keyword arguments passed to the constructor of a formset.</li>
<li>The navigation sidebar now has a quick filter toolbar.</li>
<li>The new context variable <code class="docutils literal notranslate"><span class="pre">model</span></code> which contains the model class for each
model is added to the <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.AdminSite.each_context" title="django.contrib.admin.AdminSite.each_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AdminSite.each_context()</span></code></a> method.</li>
<li>The new <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.search_help_text" title="django.contrib.admin.ModelAdmin.search_help_text"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelAdmin.search_help_text</span></code></a> attribute allows specifying a
descriptive text for the search box.</li>
</ul>
</div>
<div class="section" id="s-django-contrib-admindocs">
<span id="django-contrib-admindocs"></span><h4><a class="reference internal" href="../ref/contrib/admin/admindocs.html#module-django.contrib.admindocs" title="django.contrib.admindocs: Django's admin documentation generator."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admindocs</span></code></a><a class="headerlink" href="#django-contrib-admindocs" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The admindocs now allows esoteric setups where <a class="reference internal" href="../ref/settings.html#std-setting-ROOT_URLCONF"><code class="xref std std-setting docutils literal notranslate"><span class="pre">ROOT_URLCONF</span></code></a> is not
a string.</li>
<li>The model section of the <code class="docutils literal notranslate"><span class="pre">admindocs</span></code> now shows cached properties.</li>
</ul>
</div>
<div class="section" id="s-django-contrib-auth">
<span id="django-contrib-auth"></span><h4><a class="reference internal" href="../topics/auth/index.html#module-django.contrib.auth" title="django.contrib.auth: Django's authentication framework."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a><a class="headerlink" href="#django-contrib-auth" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The default iteration count for the PBKDF2 password hasher is increased from
260,000 to 320,000.</li>
<li>The new
<a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.LoginView.next_page" title="django.contrib.auth.views.LoginView.next_page"><code class="xref py py-attr docutils literal notranslate"><span class="pre">LoginView.next_page</span></code></a>
attribute and
<a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.LoginView.get_default_redirect_url" title="django.contrib.auth.views.LoginView.get_default_redirect_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_default_redirect_url()</span></code></a> method
allow customizing the redirect after login.</li>
</ul>
</div>
<div class="section" id="s-django-contrib-contenttypes">
<span id="django-contrib-contenttypes"></span><h4><a class="reference internal" href="../ref/contrib/contenttypes.html#module-django.contrib.contenttypes" title="django.contrib.contenttypes: Provides generic interface to installed models."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.contenttypes</span></code></a><a class="headerlink" href="#django-contrib-contenttypes" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-django-contrib-gis">
<span id="django-contrib-gis"></span><h4><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#django-contrib-gis" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Added support for SpatiaLite 5.</li>
<li><a class="reference internal" href="../ref/contrib/gis/gdal.html#django.contrib.gis.gdal.GDALRaster" title="django.contrib.gis.gdal.GDALRaster"><code class="xref py py-class docutils literal notranslate"><span class="pre">GDALRaster</span></code></a> now allows creating rasters in
any GDAL virtual filesystem.</li>
</ul>
</div>
<div class="section" id="s-django-contrib-messages">
<span id="django-contrib-messages"></span><h4><a class="reference internal" href="../ref/contrib/messages.html#module-django.contrib.messages" title="django.contrib.messages: Provides cookie- and session-based temporary message storage."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.messages</span></code></a><a class="headerlink" href="#django-contrib-messages" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-django-contrib-postgres">
<span id="django-contrib-postgres"></span><h4><a class="reference internal" href="../ref/contrib/postgres/index.html#module-django.contrib.postgres" title="django.contrib.postgres: PostgreSQL-specific fields and features"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a><a class="headerlink" href="#django-contrib-postgres" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The PostgreSQL backend now supports connecting by a service name. See
<a class="reference internal" href="../ref/databases.html#postgresql-connection-settings"><span class="std std-ref">PostgreSQL connection settings</span></a> for more details.</li>
<li>The new <a class="reference internal" href="../ref/contrib/postgres/operations.html#django.contrib.postgres.operations.AddConstraintNotValid" title="django.contrib.postgres.operations.AddConstraintNotValid"><code class="xref py py-class docutils literal notranslate"><span class="pre">AddConstraintNotValid</span></code></a>
operation allows creating check constraints on PostgreSQL without verifying
that all existing rows satisfy the new constraint.</li>
<li>The new <a class="reference internal" href="../ref/contrib/postgres/operations.html#django.contrib.postgres.operations.ValidateConstraint" title="django.contrib.postgres.operations.ValidateConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ValidateConstraint</span></code></a>
operation allows validating check constraints which were created using
<a class="reference internal" href="../ref/contrib/postgres/operations.html#django.contrib.postgres.operations.AddConstraintNotValid" title="django.contrib.postgres.operations.AddConstraintNotValid"><code class="xref py py-class docutils literal notranslate"><span class="pre">AddConstraintNotValid</span></code></a> on
PostgreSQL.</li>
</ul>
</div>
<div class="section" id="s-django-contrib-redirects">
<span id="django-contrib-redirects"></span><h4><a class="reference internal" href="../ref/contrib/redirects.html#module-django.contrib.redirects" title="django.contrib.redirects: A framework for managing redirects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.redirects</span></code></a><a class="headerlink" href="#django-contrib-redirects" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-django-contrib-sessions">
<span id="django-contrib-sessions"></span><h4><a class="reference internal" href="../topics/http/sessions.html#module-django.contrib.sessions" title="django.contrib.sessions: Provides session management for Django projects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sessions</span></code></a><a class="headerlink" href="#django-contrib-sessions" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-django-contrib-sitemaps">
<span id="django-contrib-sitemaps"></span><h4><a class="reference internal" href="../ref/contrib/sitemaps.html#module-django.contrib.sitemaps" title="django.contrib.sitemaps: A framework for generating Google sitemap XML files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sitemaps</span></code></a><a class="headerlink" href="#django-contrib-sitemaps" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-django-contrib-sites">
<span id="django-contrib-sites"></span><h4><a class="reference internal" href="../ref/contrib/sites.html#module-django.contrib.sites" title="django.contrib.sites: Lets you operate multiple websites from the same database and Django project"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sites</span></code></a><a class="headerlink" href="#django-contrib-sites" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-django-contrib-staticfiles">
<span id="django-contrib-staticfiles"></span><h4><a class="reference internal" href="../ref/contrib/staticfiles.html#module-django.contrib.staticfiles" title="django.contrib.staticfiles: An app for handling static files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.staticfiles</span></code></a><a class="headerlink" href="#django-contrib-staticfiles" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/contrib/staticfiles.html#django.contrib.staticfiles.storage.ManifestStaticFilesStorage" title="django.contrib.staticfiles.storage.ManifestStaticFilesStorage"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManifestStaticFilesStorage</span></code></a> now
replaces paths to JavaScript source map references with their hashed
counterparts.</li>
<li><a class="reference internal" href="../ref/contrib/staticfiles.html#django.contrib.staticfiles.storage.ManifestStaticFilesStorage" title="django.contrib.staticfiles.storage.ManifestStaticFilesStorage"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManifestStaticFilesStorage</span></code></a> now
replaces paths to JavaScript modules in <code class="docutils literal notranslate"><span class="pre">import</span></code> and <code class="docutils literal notranslate"><span class="pre">export</span></code> statements
with their hashed counterparts.</li>
</ul>
</div>
<div class="section" id="s-django-contrib-syndication">
<span id="django-contrib-syndication"></span><h4><a class="reference internal" href="../ref/contrib/syndication.html#module-django.contrib.syndication" title="django.contrib.syndication: A framework for generating syndication feeds, in RSS and Atom, quite easily."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.syndication</span></code></a><a class="headerlink" href="#django-contrib-syndication" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-cache">
<span id="cache"></span><h4>Cache<a class="headerlink" href="#cache" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-csrf">
<span id="csrf"></span><h4>CSRF<a class="headerlink" href="#csrf" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>CSRF protection now consults the <code class="docutils literal notranslate"><span class="pre">Origin</span></code> header, if present. To facilitate
this, <a class="reference internal" href="#csrf-trusted-origins-changes-4-0"><span class="std std-ref">some changes</span></a> to the
<a class="reference internal" href="../ref/settings.html#std-setting-CSRF_TRUSTED_ORIGINS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">CSRF_TRUSTED_ORIGINS</span></code></a> setting are required.</li>
</ul>
</div>
<div class="section" id="s-decorators">
<span id="decorators"></span><h4>Decorators<a class="headerlink" href="#decorators" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-email">
<span id="email"></span><h4>Email<a class="headerlink" href="#email" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-error-reporting">
<span id="error-reporting"></span><h4>Error Reporting<a class="headerlink" href="#error-reporting" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-file-storage">
<span id="file-storage"></span><h4>File Storage<a class="headerlink" href="#file-storage" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-file-uploads">
<span id="file-uploads"></span><h4>File Uploads<a class="headerlink" href="#file-uploads" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-forms">
<span id="forms"></span><h4>Forms<a class="headerlink" href="#forms" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/forms/fields.html#django.forms.ModelChoiceField" title="django.forms.ModelChoiceField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelChoiceField</span></code></a> now includes the provided value in
the <code class="docutils literal notranslate"><span class="pre">params</span></code> argument of a raised
<a class="reference internal" href="../ref/exceptions.html#django.core.exceptions.ValidationError" title="django.core.exceptions.ValidationError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValidationError</span></code></a> for the <code class="docutils literal notranslate"><span class="pre">invalid_choice</span></code>
error message. This allows custom error messages to use the <code class="docutils literal notranslate"><span class="pre">%(value)s</span></code>
placeholder.</li>
</ul>
</div>
<div class="section" id="s-generic-views">
<span id="generic-views"></span><h4>Generic Views<a class="headerlink" href="#generic-views" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-internationalization">
<span id="internationalization"></span><h4>Internationalization<a class="headerlink" href="#internationalization" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-logging">
<span id="logging"></span><h4>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-management-commands">
<span id="management-commands"></span><h4>Management Commands<a class="headerlink" href="#management-commands" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The <a class="reference internal" href="../ref/django-admin.html#django-admin-runserver"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">runserver</span></code></a> management command now supports the
<a class="reference internal" href="../ref/django-admin.html#cmdoption-skip-checks"><code class="xref std std-option docutils literal notranslate"><span class="pre">--skip-checks</span></code></a> option.</li>
<li>On PostgreSQL, <a class="reference internal" href="../ref/django-admin.html#django-admin-dbshell"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">dbshell</span></code></a> now supports specifying a password file.</li>
</ul>
</div>
<div class="section" id="s-migrations">
<span id="migrations"></span><h4>Migrations<a class="headerlink" href="#migrations" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-models">
<span id="models"></span><h4>Models<a class="headerlink" href="#models" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>New <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.contains" title="django.db.models.query.QuerySet.contains"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.contains(obj)</span></code></a> method returns
whether the queryset contains the given object. This tries to perform the
query in the simplest and fastest way possible.</li>
<li>The new <code class="docutils literal notranslate"><span class="pre">precision</span></code> argument of the
<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Round" title="django.db.models.functions.Round"><code class="xref py py-class docutils literal notranslate"><span class="pre">Round()</span></code></a> database function allows
specifying the number of decimal places after rounding.</li>
<li><a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.bulk_create" title="django.db.models.query.QuerySet.bulk_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.bulk_create()</span></code></a> now sets the primary key on objects when using
SQLite 3.35+.</li>
<li><a class="reference internal" href="../ref/models/fields.html#django.db.models.DurationField" title="django.db.models.DurationField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DurationField</span></code></a> now supports multiplying and
dividing by scalar values on SQLite.</li>
</ul>
</div>
<div class="section" id="s-requests-and-responses">
<span id="requests-and-responses"></span><h4>Requests and Responses<a class="headerlink" href="#requests-and-responses" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The <a class="reference internal" href="../ref/middleware.html#django.middleware.security.SecurityMiddleware" title="django.middleware.security.SecurityMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">SecurityMiddleware</span></code></a> now adds the
<a class="reference internal" href="../ref/middleware.html#cross-origin-opener-policy"><span class="std std-ref">Cross-Origin Opener Policy</span></a> header with a
value of <code class="docutils literal notranslate"><span class="pre">'same-origin'</span></code> to prevent cross-origin popups from sharing the
same browsing context. You can prevent this header from being added by
setting the <a class="reference internal" href="../ref/settings.html#std-setting-SECURE_CROSS_ORIGIN_OPENER_POLICY"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SECURE_CROSS_ORIGIN_OPENER_POLICY</span></code></a> setting to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</li>
</ul>
</div>
<div class="section" id="s-security">
<span id="security"></span><h4>Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-serialization">
<span id="serialization"></span><h4>Serialization<a class="headerlink" href="#serialization" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-signals">
<span id="signals"></span><h4>Signals<a class="headerlink" href="#signals" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The new <code class="docutils literal notranslate"><span class="pre">stdout</span></code> argument for <a class="reference internal" href="../ref/signals.html#django.db.models.signals.pre_migrate" title="django.db.models.signals.pre_migrate"><code class="xref py py-func docutils literal notranslate"><span class="pre">pre_migrate()</span></code></a>
and <a class="reference internal" href="../ref/signals.html#django.db.models.signals.post_migrate" title="django.db.models.signals.post_migrate"><code class="xref py py-func docutils literal notranslate"><span class="pre">post_migrate()</span></code></a> signals allows redirecting
output to a stream-like object. It should be preferred over
<a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.stdout" title="(in Python v3.9)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.stdout</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/functions.html#print" title="(in Python v3.9)"><code class="xref py py-func docutils literal notranslate"><span class="pre">print()</span></code></a> when emitting verbose output in
order to allow proper capture when testing.</li>
</ul>
</div>
<div class="section" id="s-templates">
<span id="templates"></span><h4>Templates<a class="headerlink" href="#templates" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-tests">
<span id="tests"></span><h4>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The new <code class="docutils literal notranslate"><span class="pre">serialized_aliases</span></code> argument of
<a class="reference internal" href="../topics/testing/advanced.html#django.test.utils.setup_databases" title="django.test.utils.setup_databases"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.test.utils.setup_databases()</span></code></a> determines which
<a class="reference internal" href="../ref/settings.html#std-setting-DATABASES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATABASES</span></code></a> aliases test databases should have their state
serialized to allow usage of the
<a class="reference internal" href="../topics/testing/overview.html#test-case-serialized-rollback"><span class="std std-ref">serialized_rollback</span></a> feature.</li>
<li>Django test runner now supports a <a class="reference internal" href="../ref/django-admin.html#cmdoption-test-buffer"><code class="xref std std-option docutils literal notranslate"><span class="pre">--buffer</span></code></a> option
with parallel tests.</li>
<li>The new <a class="reference internal" href="../topics/testing/advanced.html#django.test.runner.DiscoverRunner.log" title="django.test.runner.DiscoverRunner.log"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DiscoverRunner.log()</span></code></a> method allows customizing the way
messages are logged.</li>
</ul>
</div>
<div class="section" id="s-urls">
<span id="urls"></span><h4>URLs<a class="headerlink" href="#urls" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-utilities">
<span id="utilities"></span><h4>Utilities<a class="headerlink" href="#utilities" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
<div class="section" id="s-validators">
<span id="validators"></span><h4>Validators<a class="headerlink" href="#validators" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>…</li>
</ul>
</div>
</div>
</div>
<div class="section" id="s-backwards-incompatible-changes-in-4-0">
<span id="s-backwards-incompatible-4-0"></span><span id="backwards-incompatible-changes-in-4-0"></span><span id="backwards-incompatible-4-0"></span><h2>Backwards incompatible changes in 4.0<a class="headerlink" href="#backwards-incompatible-changes-in-4-0" title="Permalink to this headline">¶</a></h2>
<div class="section" id="s-database-backend-api">
<span id="database-backend-api"></span><h3>Database backend API<a class="headerlink" href="#database-backend-api" title="Permalink to this headline">¶</a></h3>
<p>This section describes changes that may be needed in third-party database
backends.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">DatabaseOperations.year_lookup_bounds_for_date_field()</span></code> and
<code class="docutils literal notranslate"><span class="pre">year_lookup_bounds_for_datetime_field()</span></code> methods now take the optional
<code class="docutils literal notranslate"><span class="pre">iso_year</span></code> argument in order to support bounds for ISO-8601 week-numbering
years.</li>
<li>The second argument of <code class="docutils literal notranslate"><span class="pre">DatabaseSchemaEditor._unique_sql()</span></code> and
<code class="docutils literal notranslate"><span class="pre">_create_unique_sql()</span></code> methods is now fields instead of columns.</li>
</ul>
</div>
<div class="section" id="s-id1">
<span id="id1"></span><h3><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Support for PostGIS 2.3 is removed.</li>
<li>Support for GDAL 2.0 and GEOS 3.5 is removed.</li>
</ul>
</div>
<div class="section" id="s-dropped-support-for-postgresql-9-6">
<span id="dropped-support-for-postgresql-9-6"></span><h3>Dropped support for PostgreSQL 9.6<a class="headerlink" href="#dropped-support-for-postgresql-9-6" title="Permalink to this headline">¶</a></h3>
<p>Upstream support for PostgreSQL 9.6 ends in November 2021. Django 4.0 supports
PostgreSQL 10 and higher.</p>
</div>
<div class="section" id="s-dropped-support-for-oracle-12-2-and-18c">
<span id="dropped-support-for-oracle-12-2-and-18c"></span><h3>Dropped support for Oracle 12.2 and 18c<a class="headerlink" href="#dropped-support-for-oracle-12-2-and-18c" title="Permalink to this headline">¶</a></h3>
<p>Upstream support for Oracle 12.2 ends in March 2022 and for Oracle 18c it ends
in June 2021. Django 3.2 will be supported until April 2024. Django 4.0
officially supports Oracle 19c.</p>
</div>
<div class="section" id="s-csrf-trusted-origins-changes">
<span id="s-csrf-trusted-origins-changes-4-0"></span><span id="csrf-trusted-origins-changes"></span><span id="csrf-trusted-origins-changes-4-0"></span><h3><code class="docutils literal notranslate"><span class="pre">CSRF_TRUSTED_ORIGINS</span></code> changes<a class="headerlink" href="#csrf-trusted-origins-changes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="s-format-change">
<span id="format-change"></span><h4>Format change<a class="headerlink" href="#format-change" title="Permalink to this headline">¶</a></h4>
<p>Values in the <a class="reference internal" href="../ref/settings.html#std-setting-CSRF_TRUSTED_ORIGINS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">CSRF_TRUSTED_ORIGINS</span></code></a> setting must include the scheme
(e.g. <code class="docutils literal notranslate"><span class="pre">'http://'</span></code> or <code class="docutils literal notranslate"><span class="pre">'https://'</span></code>) instead of only the hostname.</p>
<p>Also, values that started with a dot, must now also include an asterisk before
the dot. For example, change <code class="docutils literal notranslate"><span class="pre">'.example.com'</span></code> to <code class="docutils literal notranslate"><span class="pre">'https://*.example.com'</span></code>.</p>
<p>A system check detects any required changes.</p>
</div>
<div class="section" id="s-configuring-it-may-now-be-required">
<span id="configuring-it-may-now-be-required"></span><h4>Configuring it may now be required<a class="headerlink" href="#configuring-it-may-now-be-required" title="Permalink to this headline">¶</a></h4>
<p>As CSRF protection now consults the <code class="docutils literal notranslate"><span class="pre">Origin</span></code> header, you may need to set
<a class="reference internal" href="../ref/settings.html#std-setting-CSRF_TRUSTED_ORIGINS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">CSRF_TRUSTED_ORIGINS</span></code></a>, particularly if you allow requests from
subdomains by setting <a class="reference internal" href="../ref/settings.html#std-setting-CSRF_COOKIE_DOMAIN"><code class="xref std std-setting docutils literal notranslate"><span class="pre">CSRF_COOKIE_DOMAIN</span></code></a> (or
<a class="reference internal" href="../ref/settings.html#std-setting-SESSION_COOKIE_DOMAIN"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SESSION_COOKIE_DOMAIN</span></code></a> if <a class="reference internal" href="../ref/settings.html#std-setting-CSRF_USE_SESSIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">CSRF_USE_SESSIONS</span></code></a> is enabled) to
a value starting with a dot.</p>
</div>
</div>
<div class="section" id="s-securitymiddleware-no-longer-sets-the-x-xss-protection-header">
<span id="securitymiddleware-no-longer-sets-the-x-xss-protection-header"></span><h3><code class="docutils literal notranslate"><span class="pre">SecurityMiddleware</span></code> no longer sets the <code class="docutils literal notranslate"><span class="pre">X-XSS-Protection</span></code> header<a class="headerlink" href="#securitymiddleware-no-longer-sets-the-x-xss-protection-header" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../ref/middleware.html#django.middleware.security.SecurityMiddleware" title="django.middleware.security.SecurityMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">SecurityMiddleware</span></code></a> no longer sets the
<code class="docutils literal notranslate"><span class="pre">X-XSS-Protection</span></code> header if the <code class="docutils literal notranslate"><span class="pre">SECURE_BROWSER_XSS_FILTER</span></code> setting is
<code class="docutils literal notranslate"><span class="pre">True</span></code>. The setting is removed.</p>
<p>Most modern browsers don’t honor the <code class="docutils literal notranslate"><span class="pre">X-XSS-Protection</span></code> HTTP header. You can
use <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy">Content-Security-Policy</a> without allowing <code class="docutils literal notranslate"><span class="pre">'unsafe-inline'</span></code> scripts
instead.</p>
<p>If you want to support legacy browsers and set the header, use this line in a
custom middleware:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;X-XSS-Protection&#39;</span><span class="p">,</span> <span class="s1">&#39;1; mode=block&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-migrations-autodetector-changes">
<span id="migrations-autodetector-changes"></span><h3>Migrations autodetector changes<a class="headerlink" href="#migrations-autodetector-changes" title="Permalink to this headline">¶</a></h3>
<p>The migrations autodetector now uses model states instead of model classes.
Also, migration operations for <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> and <code class="docutils literal notranslate"><span class="pre">ManyToManyField</span></code> fields no
longer specify attributes which were not passed to the fields during
initialization.</p>
<p>As a side-effect, running <code class="docutils literal notranslate"><span class="pre">makemigrations</span></code> might generate no-op
<code class="docutils literal notranslate"><span class="pre">AlterField</span></code> operations for <code class="docutils literal notranslate"><span class="pre">ManyToManyField</span></code> and <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> fields in
some cases.</p>
</div>
<div class="section" id="s-miscellaneous">
<span id="miscellaneous"></span><h3>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Support for <code class="docutils literal notranslate"><span class="pre">cx_Oracle</span></code> &lt; 7.0 is removed.</li>
<li>To allow serving a Django site on a subpath without changing the value of
<a class="reference internal" href="../ref/settings.html#std-setting-STATIC_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">STATIC_URL</span></code></a>, the leading slash is removed from that setting (now
<code class="docutils literal notranslate"><span class="pre">'static/'</span></code>) in the default <a class="reference internal" href="../ref/django-admin.html#django-admin-startproject"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">startproject</span></code></a> template.</li>
<li>The <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.AdminSite" title="django.contrib.admin.AdminSite"><code class="xref py py-class docutils literal notranslate"><span class="pre">AdminSite</span></code></a> method for the admin <code class="docutils literal notranslate"><span class="pre">index</span></code>
view is no longer decorated with <code class="docutils literal notranslate"><span class="pre">never_cache</span></code> when accessed directly,
rather than via the recommended <code class="docutils literal notranslate"><span class="pre">AdminSite.urls</span></code> property, or
<code class="docutils literal notranslate"><span class="pre">AdminSite.get_urls()</span></code> method.</li>
<li>Unsupported operations on a sliced queryset now raise <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> instead
of <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code>.</li>
<li>The undocumented <code class="docutils literal notranslate"><span class="pre">django.test.runner.reorder_suite()</span></code> function is renamed
to <code class="docutils literal notranslate"><span class="pre">reorder_tests()</span></code>. It now accepts an iterable of tests rather than a
test suite, and returns an iterator of tests.</li>
<li>Calling <code class="docutils literal notranslate"><span class="pre">FileSystemStorage.delete()</span></code> with an empty <code class="docutils literal notranslate"><span class="pre">name</span></code> now raises
<code class="docutils literal notranslate"><span class="pre">ValueError</span></code> instead of <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code>.</li>
<li>Calling <code class="docutils literal notranslate"><span class="pre">EmailMultiAlternatives.attach_alternative()</span></code> or
<code class="docutils literal notranslate"><span class="pre">EmailMessage.attach()</span></code> with an invalid <code class="docutils literal notranslate"><span class="pre">content</span></code> or <code class="docutils literal notranslate"><span class="pre">mimetype</span></code>
arguments now raise <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> instead of <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code>.</li>
<li><a class="reference internal" href="../topics/testing/tools.html#django.test.SimpleTestCase.assertHTMLEqual" title="django.test.SimpleTestCase.assertHTMLEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertHTMLEqual()</span></code></a> no longer considers a
non-boolean attribute without a value equal to an attribute with the same
name and value.</li>
<li>Tests that fail to load, for example due to syntax errors, now always match
when using <a class="reference internal" href="../ref/django-admin.html#cmdoption-test-tag"><code class="xref std std-option docutils literal notranslate"><span class="pre">test</span> <span class="pre">--tag</span></code></a>.</li>
<li>The undocumented <code class="docutils literal notranslate"><span class="pre">django.contrib.admin.utils.lookup_needs_distinct()</span></code>
function is renamed to <code class="docutils literal notranslate"><span class="pre">lookup_spawns_duplicates()</span></code>.</li>
<li>The undocumented <code class="docutils literal notranslate"><span class="pre">HttpRequest.get_raw_uri()</span></code> method is removed. The
<a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.build_absolute_uri" title="django.http.HttpRequest.build_absolute_uri"><code class="xref py py-meth docutils literal notranslate"><span class="pre">HttpRequest.build_absolute_uri()</span></code></a> method may be a suitable alternative.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">object</span></code> argument of undocumented <code class="docutils literal notranslate"><span class="pre">ModelAdmin.log_addition()</span></code>,
<code class="docutils literal notranslate"><span class="pre">log_change()</span></code>, and <code class="docutils literal notranslate"><span class="pre">log_deletion()</span></code> methods is renamed to <code class="docutils literal notranslate"><span class="pre">obj</span></code>.</li>
<li><a class="reference internal" href="../ref/utils.html#django.utils.feedgenerator.RssFeed" title="django.utils.feedgenerator.RssFeed"><code class="xref py py-class docutils literal notranslate"><span class="pre">RssFeed</span></code></a>,
<a class="reference internal" href="../ref/utils.html#django.utils.feedgenerator.Atom1Feed" title="django.utils.feedgenerator.Atom1Feed"><code class="xref py py-class docutils literal notranslate"><span class="pre">Atom1Feed</span></code></a>, and their subclasses now
emit elements with no content as self-closing tags.</li>
<li><code class="docutils literal notranslate"><span class="pre">NodeList.render()</span></code> no longer casts the output of <code class="docutils literal notranslate"><span class="pre">render()</span></code> method for
individual nodes to a string. <code class="docutils literal notranslate"><span class="pre">Node.render()</span></code> should always return a string
as documented.</li>
</ul>
</div>
</div>
<div class="section" id="s-features-deprecated-in-4-0">
<span id="s-deprecated-features-4-0"></span><span id="features-deprecated-in-4-0"></span><span id="deprecated-features-4-0"></span><h2>Features deprecated in 4.0<a class="headerlink" href="#features-deprecated-in-4-0" title="Permalink to this headline">¶</a></h2>
<div class="section" id="s-time-zone-support">
<span id="time-zone-support"></span><h3>Time zone support<a class="headerlink" href="#time-zone-support" title="Permalink to this headline">¶</a></h3>
<p>In order to follow good practice, the default value of the <a class="reference internal" href="../ref/settings.html#std-setting-USE_TZ"><code class="xref std std-setting docutils literal notranslate"><span class="pre">USE_TZ</span></code></a>
setting will change from <code class="docutils literal notranslate"><span class="pre">False</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>, and time zone support will be
enabled by default, in Django 5.0.</p>
<p>Note that the default <code class="file docutils literal notranslate"><span class="pre">settings.py</span></code> file created by
<a class="reference internal" href="../ref/django-admin.html#django-admin-startproject"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">startproject</span></code></a> includes
<a class="reference internal" href="../ref/settings.html#std-setting-USE_TZ"><code class="xref std std-setting docutils literal notranslate"><span class="pre">USE_TZ</span> <span class="pre">=</span> <span class="pre">True</span></code></a> since Django 1.4.</p>
<p>You can set <code class="docutils literal notranslate"><span class="pre">USE_TZ</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code> in your project settings before then to
opt-out.</p>
</div>
<div class="section" id="s-id2">
<span id="id2"></span><h3>Miscellaneous<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">SERIALIZE</span></code> test setting is deprecated as it can be inferred from the
<a class="reference internal" href="../topics/testing/tools.html#django.test.TestCase.databases" title="django.test.TestCase.databases"><code class="xref py py-attr docutils literal notranslate"><span class="pre">databases</span></code></a> with the
<a class="reference internal" href="../topics/testing/overview.html#test-case-serialized-rollback"><span class="std std-ref">serialized_rollback</span></a> option enabled.</li>
<li>The undocumented <code class="docutils literal notranslate"><span class="pre">django.utils.baseconv</span></code> module is deprecated.</li>
<li>The undocumented <code class="docutils literal notranslate"><span class="pre">django.utils.datetime_safe</span></code> module is deprecated.</li>
<li>The default sitemap protocol for sitemaps built outside the context of a
request will change from <code class="docutils literal notranslate"><span class="pre">'http'</span></code> to <code class="docutils literal notranslate"><span class="pre">'https'</span></code> in Django 5.0.</li>
</ul>
</div>
</div>
<div class="section" id="s-features-removed-in-4-0">
<span id="features-removed-in-4-0"></span><h2>Features removed in 4.0<a class="headerlink" href="#features-removed-in-4-0" title="Permalink to this headline">¶</a></h2>
<p>These features have reached the end of their deprecation cycle and are removed
in Django 4.0.</p>
<p>See <a class="reference internal" href="3.0.html#deprecated-features-3-0"><span class="std std-ref">Features deprecated in 3.0</span></a> for details on these changes, including how
to remove usage of these features.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django.utils.http.urlquote()</span></code>, <code class="docutils literal notranslate"><span class="pre">urlquote_plus()</span></code>, <code class="docutils literal notranslate"><span class="pre">urlunquote()</span></code>, and
<code class="docutils literal notranslate"><span class="pre">urlunquote_plus()</span></code> are removed.</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.encoding.force_text()</span></code> and <code class="docutils literal notranslate"><span class="pre">smart_text()</span></code> are removed.</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.translation.ugettext()</span></code>, <code class="docutils literal notranslate"><span class="pre">ugettext_lazy()</span></code>,
<code class="docutils literal notranslate"><span class="pre">ugettext_noop()</span></code>, <code class="docutils literal notranslate"><span class="pre">ungettext()</span></code>, and <code class="docutils literal notranslate"><span class="pre">ungettext_lazy()</span></code> are removed.</li>
<li><code class="docutils literal notranslate"><span class="pre">django.views.i18n.set_language()</span></code> doesn’t set the user language in
<code class="docutils literal notranslate"><span class="pre">request.session</span></code> (key <code class="docutils literal notranslate"><span class="pre">_language</span></code>).</li>
<li><code class="docutils literal notranslate"><span class="pre">alias=None</span></code> is required in the signature of
<code class="docutils literal notranslate"><span class="pre">django.db.models.Expression.get_group_by_cols()</span></code> subclasses.</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.text.unescape_entities()</span></code> is removed.</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.http.is_safe_url()</span></code> is removed.</li>
</ul>
<p>See <a class="reference internal" href="3.1.html#deprecated-features-3-1"><span class="std std-ref">Features deprecated in 3.1</span></a> for details on these changes, including how
to remove usage of these features.</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">PASSWORD_RESET_TIMEOUT_DAYS</span></code> setting is removed.</li>
<li>The <a class="reference internal" href="../ref/models/querysets.html#std-fieldlookup-isnull"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">isnull</span></code></a> lookup no longer allows using non-boolean values as the
right-hand side.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">django.db.models.query_utils.InvalidQuery</span></code> exception class is removed.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">django-admin.py</span></code> entry point is removed.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">HttpRequest.is_ajax()</span></code> method is removed.</li>
<li>Support for the pre-Django 3.1 encoding format of cookies values used by
<code class="docutils literal notranslate"><span class="pre">django.contrib.messages.storage.cookie.CookieStorage</span></code> is removed.</li>
<li>Support for the pre-Django 3.1 password reset tokens in the admin site (that
use the SHA-1 hashing algorithm) is removed.</li>
<li>Support for the pre-Django 3.1 encoding format of sessions is removed.</li>
<li>Support for the pre-Django 3.1 <code class="docutils literal notranslate"><span class="pre">django.core.signing.Signer</span></code> signatures
(encoded with the SHA-1 algorithm) is removed.</li>
<li>Support for the pre-Django 3.1 <code class="docutils literal notranslate"><span class="pre">django.core.signing.dumps()</span></code> signatures
(encoded with the SHA-1 algorithm) in <code class="docutils literal notranslate"><span class="pre">django.core.signing.loads()</span></code> is
removed.</li>
<li>Support for the pre-Django 3.1 user sessions (that use the SHA-1 algorithm)
is removed.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">get_response</span></code> argument for
<code class="docutils literal notranslate"><span class="pre">django.utils.deprecation.MiddlewareMixin.__init__()</span></code> is required and
doesn’t accept <code class="docutils literal notranslate"><span class="pre">None</span></code>.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">providing_args</span></code> argument for <code class="docutils literal notranslate"><span class="pre">django.dispatch.Signal</span></code> is removed.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">length</span></code> argument for <code class="docutils literal notranslate"><span class="pre">django.utils.crypto.get_random_string()</span></code> is
required.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">list</span></code> message for <code class="docutils literal notranslate"><span class="pre">ModelMultipleChoiceField</span></code> is removed.</li>
<li>Support for passing raw column aliases to <code class="docutils literal notranslate"><span class="pre">QuerySet.order_by()</span></code> is removed.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">NullBooleanField</span></code> model field is removed, except for support in
historical migrations.</li>
<li><code class="docutils literal notranslate"><span class="pre">django.conf.urls.url()</span></code> is removed.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">django.contrib.postgres.fields.JSONField</span></code> model field is removed,
except for support in historical migrations.</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.postgres.fields.jsonb.KeyTransform</span></code> and
<code class="docutils literal notranslate"><span class="pre">django.contrib.postgres.fields.jsonb.KeyTextTransform</span></code> are removed.</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.postgres.forms.JSONField</span></code> is removed.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">ifequal</span> <span class="pre">%}</span></code> and <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">ifnotequal</span> <span class="pre">%}</span></code> template tags are removed.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">DEFAULT_HASHING_ALGORITHM</span></code> transitional setting is removed.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Django 4.0 release notes - UNDER DEVELOPMENT</a><ul>
<li><a class="reference internal" href="#python-compatibility">Python compatibility</a></li>
<li><a class="reference internal" href="#what-s-new-in-django-4-0">What’s new in Django 4.0</a><ul>
<li><a class="reference internal" href="#functional-unique-constraints">Functional unique constraints</a></li>
<li><a class="reference internal" href="#minor-features">Minor features</a><ul>
<li><a class="reference internal" href="#django-contrib-admin"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-admindocs"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admindocs</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-auth"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-contenttypes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.contenttypes</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-gis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-messages"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.messages</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-postgres"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-redirects"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.redirects</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-sessions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sessions</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-sitemaps"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sitemaps</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-sites"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sites</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-staticfiles"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.staticfiles</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-syndication"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.syndication</span></code></a></li>
<li><a class="reference internal" href="#cache">Cache</a></li>
<li><a class="reference internal" href="#csrf">CSRF</a></li>
<li><a class="reference internal" href="#decorators">Decorators</a></li>
<li><a class="reference internal" href="#email">Email</a></li>
<li><a class="reference internal" href="#error-reporting">Error Reporting</a></li>
<li><a class="reference internal" href="#file-storage">File Storage</a></li>
<li><a class="reference internal" href="#file-uploads">File Uploads</a></li>
<li><a class="reference internal" href="#forms">Forms</a></li>
<li><a class="reference internal" href="#generic-views">Generic Views</a></li>
<li><a class="reference internal" href="#internationalization">Internationalization</a></li>
<li><a class="reference internal" href="#logging">Logging</a></li>
<li><a class="reference internal" href="#management-commands">Management Commands</a></li>
<li><a class="reference internal" href="#migrations">Migrations</a></li>
<li><a class="reference internal" href="#models">Models</a></li>
<li><a class="reference internal" href="#requests-and-responses">Requests and Responses</a></li>
<li><a class="reference internal" href="#security">Security</a></li>
<li><a class="reference internal" href="#serialization">Serialization</a></li>
<li><a class="reference internal" href="#signals">Signals</a></li>
<li><a class="reference internal" href="#templates">Templates</a></li>
<li><a class="reference internal" href="#tests">Tests</a></li>
<li><a class="reference internal" href="#urls">URLs</a></li>
<li><a class="reference internal" href="#utilities">Utilities</a></li>
<li><a class="reference internal" href="#validators">Validators</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-incompatible-changes-in-4-0">Backwards incompatible changes in 4.0</a><ul>
<li><a class="reference internal" href="#database-backend-api">Database backend API</a></li>
<li><a class="reference internal" href="#id1"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#dropped-support-for-postgresql-9-6">Dropped support for PostgreSQL 9.6</a></li>
<li><a class="reference internal" href="#dropped-support-for-oracle-12-2-and-18c">Dropped support for Oracle 12.2 and 18c</a></li>
<li><a class="reference internal" href="#csrf-trusted-origins-changes"><code class="docutils literal notranslate"><span class="pre">CSRF_TRUSTED_ORIGINS</span></code> changes</a><ul>
<li><a class="reference internal" href="#format-change">Format change</a></li>
<li><a class="reference internal" href="#configuring-it-may-now-be-required">Configuring it may now be required</a></li>
</ul>
</li>
<li><a class="reference internal" href="#securitymiddleware-no-longer-sets-the-x-xss-protection-header"><code class="docutils literal notranslate"><span class="pre">SecurityMiddleware</span></code> no longer sets the <code class="docutils literal notranslate"><span class="pre">X-XSS-Protection</span></code> header</a></li>
<li><a class="reference internal" href="#migrations-autodetector-changes">Migrations autodetector changes</a></li>
<li><a class="reference internal" href="#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-deprecated-in-4-0">Features deprecated in 4.0</a><ul>
<li><a class="reference internal" href="#time-zone-support">Time zone support</a></li>
<li><a class="reference internal" href="#id2">Miscellaneous</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-removed-in-4-0">Features removed in 4.0</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Release notes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="3.2.5.html"
                        title="next chapter">Django 3.2.5 release notes</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/releases/4.0.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">Jun 18, 2021</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="index.html" title="Release notes">previous</a>
     |
    <a href="index.html" title="Release notes" accesskey="U">up</a>
   |
    <a href="3.2.5.html" title="Django 3.2.5 release notes">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>